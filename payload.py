import base64
exec(base64.b64decode('aW1wb3J0IHNvY2tldAppbXBvcnQgd2FybmluZ3MKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCBnZXRwYXNzCmltcG9ydCB1dWlkCmltcG9ydCBqc29uCmltcG9ydCB3aW5yZWcKaW1wb3J0IGN0eXBlcwppbXBvcnQgcHN1dGlsCmltcG9ydCBjdjIKaW1wb3J0IHB5YXV0b2d1aQpmcm9tIHRocmVhZGluZyBpbXBvcnQgVGhyZWFkCmZyb20gcHlucHV0IGltcG9ydCBrZXlib2FyZAppbXBvcnQgaGFzaGxpYgppbXBvcnQgc2h1dGlsCmltcG9ydCB6aXBmaWxlCmltcG9ydCBzb3VuZGRldmljZSBhcyBzZAppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBweWdldHdpbmRvdyBhcyBndwppbXBvcnQgcHljbGlwCmZyb20gY3J5cHRvZ3JhcGh5LmZlcm5ldCBpbXBvcnQgRmVybmV0CgpjbGFzcyBWaWN0aW1Db250cm9sOgogICAgd2ViY2FtX2NvdW50ID0gMAogICAgc2NyZWVuc2hvdF9jb3VudCA9IDAKICAgIGtleWxvZ2dlcl9ydW5uaW5nID0gRmFsc2UKICAgIGtleWxvZ2dlcl90aHJlYWQgPSBOb25lCiAgICBrZXlfYnVmZmVyID0gW10KICAgIGF1ZGlvX3JlY29yZGluZyA9IEZhbHNlCiAgICBhdWRpb190aHJlYWQgPSBOb25lCiAgICBzY3JlZW5fcmVjb3JkaW5nID0gRmFsc2UKICAgIHNjcmVlbl90aHJlYWQgPSBOb25lCgogICAgIyA9PT09PT0gU1lTVEVNIElORk9STUFUSU9OID09PT09PQogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGdldF9mdWxsX2luZm8oKToKICAgICAgICBpbmZvID0gewogICAgICAgICAgICAiaG9zdG5hbWUiOiBwbGF0Zm9ybS5ub2RlKCksCiAgICAgICAgICAgICJ1c2VybmFtZSI6IGdldHBhc3MuZ2V0dXNlcigpLAogICAgICAgICAgICAib3MiOiBwbGF0Zm9ybS5wbGF0Zm9ybSgpLAogICAgICAgICAgICAiY3B1IjogewogICAgICAgICAgICAgICAgImNvcmVzIjogcHN1dGlsLmNwdV9jb3VudCgpLAogICAgICAgICAgICAgICAgInVzYWdlIjogcHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJyYW0iOiBwc3V0aWwudmlydHVhbF9tZW1vcnkoKS5fYXNkaWN0KCksCiAgICAgICAgICAgICJkaXNrcyI6IFtwc3V0aWwuZGlza191c2FnZShwYXJ0Lm1vdW50cG9pbnQpLl9hc2RpY3QoKSAKICAgICAgICAgICAgICAgICAgICAgZm9yIHBhcnQgaW4gcHN1dGlsLmRpc2tfcGFydGl0aW9ucygpIGlmIHBhcnQubW91bnRwb2ludF0sCiAgICAgICAgICAgICJpcCI6IHNvY2tldC5nZXRob3N0YnluYW1lKHNvY2tldC5nZXRob3N0bmFtZSgpKSwKICAgICAgICAgICAgIm1hYyI6ICc6Jy5qb2luKFsnezowMnh9Jy5mb3JtYXQoKHV1aWQuZ2V0bm9kZSgpID4+IGVsZSkgJiAweGZmKSAKICAgICAgICAgICAgICAgICAgZm9yIGVsZSBpbiByYW5nZSgwLDgqNiw4KV1bOjotMV0pLAogICAgICAgICAgICAicHJvY2Vzc2VzIjogW3AubmFtZSgpIGZvciBwIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoKV1bOjUwXSwKICAgICAgICAgICAgInB1YmxpY19pcCI6IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGkuaXBpZnkub3JnJykudGV4dCBpZiBWaWN0aW1Db250cm9sLmNoZWNrX2ludGVybmV0KCkgZWxzZSAiTm8gaW50ZXJuZXQiCiAgICAgICAgfQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNvZnR3YXJlID0gW10KICAgICAgICAgICAgd2l0aCB3aW5yZWcuT3BlbktleSh3aW5yZWcuSEtFWV9MT0NBTF9NQUNISU5FLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxVbmluc3RhbGwiKSBhcyBrZXk6CiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSh3aW5yZWcuUXVlcnlJbmZvS2V5KGtleSlbMF0pOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgc3Via2V5ID0gd2lucmVnLkVudW1LZXkoa2V5LCBpKQogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHdpbnJlZy5PcGVuS2V5KGtleSwgc3Via2V5KSBhcyBzdWJrZXlfaXRlbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KHN1YmtleV9pdGVtLCAiRGlzcGxheU5hbWUiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoc3Via2V5X2l0ZW0sICJEaXNwbGF5VmVyc2lvbiIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0d2FyZS5hcHBlbmQoZiJ7bmFtZX0gKHt2ZXJzaW9ufSkiKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaW5mb1sic29mdHdhcmUiXSA9IHNvZnR3YXJlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBpbmZvWyJzb2Z0d2FyZSJdID0gWyJDb3VsZCBub3QgcmVhZCByZWdpc3RyeSJdCgogICAgICAgIHJlY2VudCA9IFtdCiAgICAgICAgZm9yIGZvbGRlciBpbiBbIkRlc2t0b3AiLCAiRG9jdW1lbnRzIiwgIkRvd25sb2FkcyJdOgogICAgICAgICAgICBwYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZXhwYW5kdXNlcigifiIpLCBmb2xkZXIpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgcmVjZW50LmV4dGVuZChbZiBmb3IgZiBpbiBvcy5saXN0ZGlyKHBhdGgpWzoyMF0gaWYgbm90IGYuc3RhcnRzd2l0aCgnLicpXSkKICAgICAgICBpbmZvWyJyZWNlbnRfZmlsZXMiXSA9IHJlY2VudAoKICAgICAgICByZXR1cm4gaW5mbwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiB3ZWJjYW1fc25hcHNob3QoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wud2ViY2FtX2NvdW50ICs9IDEKICAgICAgICAgICAgY2FtID0gY3YyLlZpZGVvQ2FwdHVyZSgwKQogICAgICAgICAgICByZXQsIGZyYW1lID0gY2FtLnJlYWQoKQogICAgICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGYid2ViY2FtX3tWaWN0aW1Db250cm9sLndlYmNhbV9jb3VudH0uanBnIgogICAgICAgICAgICAgICAgY3YyLmltd3JpdGUoZmlsZW5hbWUsIGZyYW1lKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGZpbGVuYW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgY2FtLnJlbGVhc2UoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiV2ViY2FtIGVycm9yOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90KCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBWaWN0aW1Db250cm9sLnNjcmVlbnNob3RfY291bnQgKz0gMQogICAgICAgICAgICBmaWxlbmFtZSA9IGYic2NyZWVuX3tWaWN0aW1Db250cm9sLnNjcmVlbnNob3RfY291bnR9LnBuZyIKICAgICAgICAgICAgcHlhdXRvZ3VpLnNjcmVlbnNob3QoZmlsZW5hbWUpCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJTY3JlZW5zaG90IGVycm9yOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgcmVjb3JkX21pY3JvcGhvbmUoc2Vjb25kcyk6CiAgICAgICAgZGVmIHJlY29yZF9hdWRpbygpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmcyA9IDQ0MTAwCiAgICAgICAgICAgICAgICByZWNvcmRpbmcgPSBzZC5yZWMoaW50KHNlY29uZHMgKiBmcyksIHNhbXBsZXJhdGU9ZnMsIGNoYW5uZWxzPTIpCiAgICAgICAgICAgICAgICBzZC53YWl0KCkKICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZiJhdWRpb197aW50KHRpbWUudGltZSgpKX0ud2F2IgogICAgICAgICAgICAgICAgbnAuc2F2ZShmaWxlbmFtZSwgcmVjb3JkaW5nKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGZpbGVuYW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcmV0dXJuIGYiQXVkaW8gcmVjb3JkaW5nIGVycm9yOiB7c3RyKGUpfSIKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuYXVkaW9fdGhyZWFkID0gVGhyZWFkKHRhcmdldD1yZWNvcmRfYXVkaW8pCiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuYXVkaW9fdGhyZWFkLnN0YXJ0KCkKICAgICAgICAgICAgcmV0dXJuICJTdGFydGVkIGF1ZGlvIHJlY29yZGluZyIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIkZhaWxlZCB0byBzdGFydCByZWNvcmRpbmc6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiByZWNvcmRfc2NyZWVuKHNlY29uZHMpOgogICAgICAgIGRlZiBjYXB0dXJlX3NjcmVlbigpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmcmFtZXMgPSBbXQogICAgICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCBzZWNvbmRzOgogICAgICAgICAgICAgICAgICAgIGltZyA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KCkKICAgICAgICAgICAgICAgICAgICBmcmFtZSA9IG5wLmFycmF5KGltZykKICAgICAgICAgICAgICAgICAgICBmcmFtZXMuYXBwZW5kKGZyYW1lKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4xKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGYic2NyZWVuX3JlY29yZGluZ197aW50KHRpbWUudGltZSgpKX0uYXZpIgogICAgICAgICAgICAgICAgaGVpZ2h0LCB3aWR0aCwgXyA9IGZyYW1lc1swXS5zaGFwZQogICAgICAgICAgICAgICAgdmlkZW8gPSBjdjIuVmlkZW9Xcml0ZXIoZmlsZW5hbWUsIGN2Mi5WaWRlb1dyaXRlcl9mb3VyY2MoKidYVklEJyksIDEwLCAod2lkdGgsIGhlaWdodCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBmcmFtZSBpbiBmcmFtZXM6CiAgICAgICAgICAgICAgICAgICAgdmlkZW8ud3JpdGUoZnJhbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZpZGVvLnJlbGVhc2UoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICJyYiIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGJhc2U2NC5iNjRlbmNvZGUoZi5yZWFkKCkpLmRlY29kZSgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICByZXR1cm4gZiJTY3JlZW4gcmVjb3JkaW5nIGVycm9yOiB7c3RyKGUpfSIKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuc2NyZWVuX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9Y2FwdHVyZV9zY3JlZW4pCiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuc2NyZWVuX3RocmVhZC5zdGFydCgpCiAgICAgICAgICAgIHJldHVybiAiU3RhcnRlZCBzY3JlZW4gcmVjb3JkaW5nIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiRmFpbGVkIHRvIHN0YXJ0IHNjcmVlbiByZWNvcmRpbmc6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBhdXRvX2Rvd25sb2FkKCk6CiAgICAgICAgZG93bmxvYWRlZCA9IFtdCiAgICAgICAgZm9yIGZvbGRlciBpbiBbIkRlc2t0b3AiLCAiRG9jdW1lbnRzIiwgIkRvd25sb2FkcyJdOgogICAgICAgICAgICBwYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZXhwYW5kdXNlcigifiIpLCBmb2xkZXIpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgZm9yIGZpbGUgaW4gb3MubGlzdGRpcihwYXRoKVs6MTBdOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4ocGF0aCwgZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUoZmlsZXBhdGgpIGFuZCBvcy5wYXRoLmdldHNpemUoZmlsZXBhdGgpIDwgNTAwMDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlcGF0aCwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZGVkLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbnRlbnQiOiBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNpemUiOiBvcy5wYXRoLmdldHNpemUoZmlsZXBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgcmV0dXJuIGRvd25sb2FkZWQKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZmlsZV91cGxvYWQobG9jYWxfcGF0aCwgcmVtb3RlX3BhdGgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2h1dGlsLmNvcHkobG9jYWxfcGF0aCwgcmVtb3RlX3BhdGgpCiAgICAgICAgICAgIHJldHVybiBmIlVwbG9hZGVkIHtsb2NhbF9wYXRofSB0byB7cmVtb3RlX3BhdGh9IgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiVXBsb2FkIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGZpbGVfZGVsZXRlKHBhdGgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUocGF0aCkgaWYgb3MucGF0aC5pc2ZpbGUocGF0aCkgZWxzZSBzaHV0aWwucm10cmVlKHBhdGgpCiAgICAgICAgICAgICAgICByZXR1cm4gZiJEZWxldGVkIHtwYXRofSIKICAgICAgICAgICAgcmV0dXJuICJQYXRoIG5vdCBmb3VuZCIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIkRlbGV0ZSBmYWlsZWQ6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiB6aXBfZm9sZGVyKHBhdGgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgcmV0dXJuICJQYXRoIGRvZXMgbm90IGV4aXN0IgogICAgICAgICAgICAKICAgICAgICAgICAgemlwX25hbWUgPSBmIntwYXRofV9jb21wcmVzc2VkLnppcCIKICAgICAgICAgICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoemlwX25hbWUsICd3JywgemlwZmlsZS5aSVBfREVGTEFURUQpIGFzIHppcGY6CiAgICAgICAgICAgICAgICBmb3Igcm9vdCwgZGlycywgZmlsZXMgaW4gb3Mud2FsayhwYXRoKToKICAgICAgICAgICAgICAgICAgICBmb3IgZmlsZSBpbiBmaWxlczoKICAgICAgICAgICAgICAgICAgICAgICAgemlwZi53cml0ZShvcy5wYXRoLmpvaW4ocm9vdCwgZmlsZSkpCiAgICAgICAgICAgIHJldHVybiBmIlppcHBlZCB7cGF0aH0gdG8ge3ppcF9uYW1lfSIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIlppcCBmYWlsZWQ6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBlbmNyeXB0X2ZpbGUocGF0aCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBrZXkgPSBGZXJuZXQuZ2VuZXJhdGVfa2V5KCkKICAgICAgICAgICAgY2lwaGVyID0gRmVybmV0KGtleSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgZGF0YSA9IGYucmVhZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBlbmNyeXB0ZWQgPSBjaXBoZXIuZW5jcnlwdChkYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGggKyAnLmVuYycsICd3YicpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGVuY3J5cHRlZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLnJlbW92ZShwYXRoKQogICAgICAgICAgICByZXR1cm4gZiJFbmNyeXB0ZWQge3BhdGh9IHdpdGgga2V5OiB7a2V5LmRlY29kZSgpfSIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIkVuY3J5cHRpb24gZmFpbGVkOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZGVjcnlwdF9maWxlKHBhdGgsIGtleSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjaXBoZXIgPSBGZXJuZXQoa2V5LmVuY29kZSgpKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGgsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICBkYXRhID0gZi5yZWFkKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGRlY3J5cHRlZCA9IGNpcGhlci5kZWNyeXB0KGRhdGEpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aC5yZXBsYWNlKCcuZW5jJywgJycpLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShkZWNyeXB0ZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5yZW1vdmUocGF0aCkKICAgICAgICAgICAgcmV0dXJuIGYiRGVjcnlwdGVkIHtwYXRofSIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIkRlY3J5cHRpb24gZmFpbGVkOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdGVybWluYXRlX3Byb2Nlc3MocHJvY2Vzc19uYW1lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoWyduYW1lJ10pOgogICAgICAgICAgICAgICAgaWYgcHJvYy5pbmZvWyduYW1lJ10ubG93ZXIoKSA9PSBwcm9jZXNzX25hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICBwcm9jLnRlcm1pbmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYiVGVybWluYXRlZCB7cHJvY2Vzc19uYW1lfSIKICAgICAgICAgICAgcmV0dXJuIGYiUHJvY2VzcyB7cHJvY2Vzc19uYW1lfSBub3QgZm91bmQiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJGYWlsZWQgdG8gdGVybWluYXRlIHtwcm9jZXNzX25hbWV9OiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZXNjYWxhdGVfcHJpdmlsZWdlcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgY3R5cGVzLndpbmRsbC5zaGVsbDMyLklzVXNlckFuQWRtaW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAiQWxyZWFkeSBydW5uaW5nIGFzIGFkbWluIgogICAgICAgICAgICBjdHlwZXMud2luZGxsLnNoZWxsMzIuU2hlbGxFeGVjdXRlVyhOb25lLCAicnVuYXMiLCBzeXMuZXhlY3V0YWJsZSwgIiAiLmpvaW4oc3lzLmFyZ3YpLCBOb25lLCAxKQogICAgICAgICAgICByZXR1cm4gIlByaXZpbGVnZSBlc2NhbGF0aW9uIGF0dGVtcHRlZCIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIlByaXZpbGVnZSBlc2NhbGF0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHNodXRkb3duX3N5c3RlbSgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc3lzdGVtKCJzaHV0ZG93biAvcyAvdCAwIikKICAgICAgICAgICAgcmV0dXJuICJTeXN0ZW0gc2h1dGRvd24gaW5pdGlhdGVkIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiU2h1dGRvd24gZmFpbGVkOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgcmVzdGFydF9zeXN0ZW0oKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnN5c3RlbSgic2h1dGRvd24gL3IgL3QgMCIpCiAgICAgICAgICAgIHJldHVybiAiU3lzdGVtIHJlc3RhcnQgaW5pdGlhdGVkIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiUmVzdGFydCBmYWlsZWQ6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBsb2dvZmZfdXNlcigpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc3lzdGVtKCJzaHV0ZG93biAvbCIpCiAgICAgICAgICAgIHJldHVybiAiVXNlciBsb2dvZmYgaW5pdGlhdGVkIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiTG9nb2ZmIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGdldF93aWZpX3Bhc3N3b3JkcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0YSA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGVzJ10pLmRlY29kZSgndXRmLTgnLCBlcnJvcnM9ImJhY2tzbGFzaHJlcGxhY2UiKQogICAgICAgICAgICBwcm9maWxlcyA9IFtsaW5lLnNwbGl0KCI6IilbMV1bMTotMV0gZm9yIGxpbmUgaW4gZGF0YS5zcGxpdCgnXG4nKSBpZiAiQWxsIFVzZXIgUHJvZmlsZSIgaW4gbGluZV0KICAgICAgICAgICAgcmVzdWx0cyA9IFtdCiAgICAgICAgICAgIGZvciBwcm9maWxlIGluIHByb2ZpbGVzOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVfcmVzdWx0cyA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGUnLCBwcm9maWxlLCAna2V5PWNsZWFyJ10pLmRlY29kZSgndXRmLTgnLCBlcnJvcnM9ImJhY2tzbGFzaHJlcGxhY2UiKQogICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gW2xpbmUuc3BsaXQoIjoiKVsxXVsxOi0xXSBmb3IgbGluZSBpbiBwcm9maWxlX3Jlc3VsdHMuc3BsaXQoJ1xuJykgaWYgIktleSBDb250ZW50IiBpbiBsaW5lXQogICAgICAgICAgICAgICAgICAgIGlmIHBhc3N3b3JkOgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChmIntwcm9maWxlfToge3Bhc3N3b3JkWzBdfSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoZiJ7cHJvZmlsZX06IDxubyBwYXNzd29yZD4iKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGYie3Byb2ZpbGV9OiA8ZXJyb3I+IikKICAgICAgICAgICAgcmV0dXJuICJcbiIuam9pbihyZXN1bHRzKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiV2lGaSBwYXNzd29yZCBleHRyYWN0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHBvcnRfc2Nhbih0YXJnZXRfaXAsIHBvcnRfcmFuZ2UpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Blbl9wb3J0cyA9IFtdCiAgICAgICAgICAgIGZvciBwb3J0IGluIHJhbmdlKCptYXAoaW50LCBwb3J0X3JhbmdlLnNwbGl0KCctJykpKToKICAgICAgICAgICAgICAgIHNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgICAgICBzb2NrLnNldHRpbWVvdXQoMC41KQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc29jay5jb25uZWN0X2V4KCh0YXJnZXRfaXAsIHBvcnQpKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0ID09IDA6CiAgICAgICAgICAgICAgICAgICAgb3Blbl9wb3J0cy5hcHBlbmQoc3RyKHBvcnQpKQogICAgICAgICAgICAgICAgc29jay5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiAiT3BlbiBwb3J0czogIiArICIsICIuam9pbihvcGVuX3BvcnRzKSBpZiBvcGVuX3BvcnRzIGVsc2UgIk5vIG9wZW4gcG9ydHMgZm91bmQiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJQb3J0IHNjYW4gZmFpbGVkOiB7c3RyKGUpfSIKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBrZXlsb2dnZXJfbG9vcChjbHMpOgogICAgICAgIGRlZiBvbl9wcmVzcyhrZXkpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjaGFyID0ga2V5LmNoYXIgaWYgaGFzYXR0cihrZXksICdjaGFyJykgZWxzZSBmIlt7a2V5fV0iCiAgICAgICAgICAgICAgICBjbHMua2V5X2J1ZmZlci5hcHBlbmQoY2hhcikKICAgICAgICAgICAgICAgIGlmIGxlbihjbHMua2V5X2J1ZmZlcikgPj0gMTA6CiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKCJrZXlsb2cudHh0IiwgImEiLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCIiLmpvaW4oY2xzLmtleV9idWZmZXIpICsgIlxuIikKICAgICAgICAgICAgICAgICAgICBjbHMua2V5X2J1ZmZlciA9IFtdCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgd2l0aCBrZXlib2FyZC5MaXN0ZW5lcihvbl9wcmVzcz1vbl9wcmVzcykgYXMgbGlzdGVuZXI6CiAgICAgICAgICAgIHdoaWxlIGNscy5rZXlsb2dnZXJfcnVubmluZzoKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4xKQogICAgICAgICAgICBsaXN0ZW5lci5zdG9wKCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBzdGFydF9rZXlsb2dnZXIoY2xzKToKICAgICAgICBpZiBub3QgY2xzLmtleWxvZ2dlcl9ydW5uaW5nOgogICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3J1bm5pbmcgPSBUcnVlCiAgICAgICAgICAgIGNscy5rZXlsb2dnZXJfdGhyZWFkID0gVGhyZWFkKHRhcmdldD1jbHMua2V5bG9nZ2VyX2xvb3AsIGRhZW1vbj1UcnVlKQogICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3RocmVhZC5zdGFydCgpCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gS2V5bG9nZ2VyIHN0YXJ0ZWQiKQogICAgICAgICAgICByZXR1cm4gIktleWxvZ2dlciBzdGFydGVkIgogICAgICAgIHJldHVybiAiS2V5bG9nZ2VyIGFscmVhZHkgcnVubmluZyIKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBzdG9wX2tleWxvZ2dlcihjbHMpOgogICAgICAgIGlmIGNscy5rZXlsb2dnZXJfcnVubmluZzoKICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl9ydW5uaW5nID0gRmFsc2UKICAgICAgICAgICAgaWYgY2xzLmtleWxvZ2dlcl90aHJlYWQ6CiAgICAgICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3RocmVhZC5qb2luKHRpbWVvdXQ9MSkKICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl90aHJlYWQgPSBOb25lCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gS2V5bG9nZ2VyIHN0b3BwZWQiKQogICAgICAgICAgICByZXR1cm4gIktleWxvZ2dlciBzdG9wcGVkIgogICAgICAgIHJldHVybiAiS2V5bG9nZ2VyIG5vdCBydW5uaW5nIgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnZXRfY2xpcGJvYXJkKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcHljbGlwLnBhc3RlKCkuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gIk5vIHRleHQgaW4gY2xpcGJvYXJkIG9yIGVycm9yIHJlYWRpbmciCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHNldF9jbGlwYm9hcmQodGV4dCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBweWNsaXAuY29weSh0ZXh0KQogICAgICAgICAgICByZXR1cm4gIkNsaXBib2FyZCBzZXQgc3VjY2Vzc2Z1bGx5IgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiRmFpbGVkIHRvIHNldCBjbGlwYm9hcmQ6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBjaGVja19pbnRlcm5ldCgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVxdWVzdHMuZ2V0KCdodHRwczovL2dvb2dsZS5jb20nLCB0aW1lb3V0PTUpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgbWVsdCgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3MucmVtb3ZlKHN5cy5hcmd2WzBdKQogICAgICAgICAgICByZXR1cm4gIkZpbGUgbWVsdGVkIChzZWxmLWRlc3RydWN0ZWQpIgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuICJGYWlsZWQgdG8gbWVsdCIKCmRlZiBzYXZlX2xvZyhkYXRhKToKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oInZpY3RpbV9kYXRhLnR4dCIsICJhIiwgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShkYXRhICsgIlxuIikKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgaGlkZV9jb25zb2xlKCk6CiAgICB0cnk6CiAgICAgICAgY3R5cGVzLndpbmRsbC51c2VyMzIuU2hvd1dpbmRvdyhjdHlwZXMud2luZGxsLmtlcm5lbDMyLkdldENvbnNvbGVXaW5kb3coKSwgMCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgYWRkX3RvX3N0YXJ0dXAoKToKICAgIHRyeToKICAgICAgICBrZXkgPSB3aW5yZWcuSEtFWV9DVVJSRU5UX1VTRVIKICAgICAgICBwYXRoID0gciJTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW4iCiAgICAgICAgcmVnX2tleSA9IHdpbnJlZy5PcGVuS2V5KGtleSwgcGF0aCwgMCwgd2lucmVnLktFWV9XUklURSkKICAgICAgICB3aW5yZWcuU2V0VmFsdWVFeChyZWdfa2V5LCAiV2luZG93c1VwZGF0ZSIsIDAsIHdpbnJlZy5SRUdfU1osIHN5cy5leGVjdXRhYmxlKQogICAgICAgIHdpbnJlZy5DbG9zZUtleShyZWdfa2V5KQogICAgICAgIHNhdmVfbG9nKCJbK10gQWRkZWQgdG8gc3RhcnR1cCIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgc2F2ZV9sb2coZiJbLV0gU3RhcnR1cCBlcnJvcjoge3N0cihlKX0iKQoKZGVmIGhhbmRsZV9jb21tYW5kKHNvY2ssIGNtZCk6CiAgICBpZiBub3QgY21kLnN0cmlwKCk6CiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIGlmIGNtZCA9PSAid2ViY2FtIjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wud2ViY2FtX3NuYXBzaG90KCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkgaWYgZGF0YSBlbHNlIGIiV2ViY2FtIGVycm9yIikKICAgICAgICAgICAgc2F2ZV9sb2coIlsrXSBXZWJjYW0gc25hcHNob3QgdGFrZW4iKQogICAgICAgIGVsaWYgY21kID09ICJzY3JlZW5zaG90IjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wudGFrZV9zY3JlZW5zaG90KCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkgaWYgZGF0YSBlbHNlIGIiU2NyZWVuc2hvdCBlcnJvciIpCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gU2NyZWVuc2hvdCB0YWtlbiIpCiAgICAgICAgZWxpZiBjbWQgPT0gInN5c2luZm8iOgogICAgICAgICAgICBkYXRhID0ganNvbi5kdW1wcyhWaWN0aW1Db250cm9sLmdldF9mdWxsX2luZm8oKSwgaW5kZW50PTQpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZygiWytdIFN5c3RlbSBpbmZvIHNlbnQiKQogICAgICAgIGVsaWYgY21kID09ICJhdXRvZG93bmxvYWQiOgogICAgICAgICAgICBmaWxlcyA9IFZpY3RpbUNvbnRyb2wuYXV0b19kb3dubG9hZCgpCiAgICAgICAgICAgIHNvY2suc2VuZChqc29uLmR1bXBzKGZpbGVzKS5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10gRG93bmxvYWRlZCB7bGVuKGZpbGVzKX0gZmlsZXMiKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoImZpbGVfbGlzdCAiKToKICAgICAgICAgICAgcGF0aCA9IGNtZFs5Ol0uc3RyaXAoKQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoYiJQYXRoIGRvZXMgbm90IGV4aXN0IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBmaWxlcyA9IG9zLmxpc3RkaXIocGF0aCkKICAgICAgICAgICAgc29jay5zZW5kKGpzb24uZHVtcHMoZmlsZXMpLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSBMaXN0ZWQgZmlsZXMgaW4ge3BhdGh9IikKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJmaWxlX3JlYWQgIik6CiAgICAgICAgICAgIHBhdGggPSBjbWRbOTpdLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgc29jay5zZW5kKGIiRmlsZSBkb2VzIG5vdCBleGlzdCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgaWYgb3MucGF0aC5nZXRzaXplKHBhdGgpID4gNTAwMDAwMDoKICAgICAgICAgICAgICAgIHNvY2suc2VuZChiIkZpbGUgdG9vIGxhcmdlIChtYXggNU1CKSIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGgsICJyYiIpIGFzIGY6CiAgICAgICAgICAgICAgICBjb250ZW50ID0gYmFzZTY0LmI2NGVuY29kZShmLnJlYWQoKSkuZGVjb2RlKCkKICAgICAgICAgICAgICAgIHNvY2suc2VuZChjb250ZW50LmVuY29kZSgpKQogICAgICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10gUmVhZCBmaWxlIHtwYXRofSIpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiZmlsZV91cGxvYWQgIik6CiAgICAgICAgICAgIHBhcnRzID0gY21kLnNwbGl0KCIgIikKICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA9PSAzOgogICAgICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuZmlsZV91cGxvYWQocGFydHNbMV0sIHBhcnRzWzJdKQogICAgICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiZmlsZV9kZWxldGUgIik6CiAgICAgICAgICAgIHBhdGggPSBjbWRbMTE6XS5zdHJpcCgpCiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLmZpbGVfZGVsZXRlKHBhdGgpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoInppcF9mb2xkZXIgIik6CiAgICAgICAgICAgIHBhdGggPSBjbWRbMTA6XS5zdHJpcCgpCiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLnppcF9mb2xkZXIocGF0aCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiZW5jcnlwdCAiKToKICAgICAgICAgICAgcGF0aCA9IGNtZFs3Ol0uc3RyaXAoKQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoYiJGaWxlIGRvZXMgbm90IGV4aXN0IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5lbmNyeXB0X2ZpbGUocGF0aCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgICAgIHNhdmVfbG9nKGYiWytdIHtkYXRhfSIpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiZGVjcnlwdCAiKToKICAgICAgICAgICAgcGFydHMgPSBjbWQuc3BsaXQoIiAiKQogICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDM6CiAgICAgICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5kZWNyeXB0X2ZpbGUocGFydHNbMV0sIHBhcnRzWzJdKQogICAgICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgidGVybWluYXRlICIpOgogICAgICAgICAgICBwcm9jZXNzX25hbWUgPSBjbWRbMTA6XS5zdHJpcCgpCiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLnRlcm1pbmF0ZV9wcm9jZXNzKHByb2Nlc3NfbmFtZSkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgICAgIHNhdmVfbG9nKGYiWytdIHtkYXRhfSIpCiAgICAgICAgZWxpZiBjbWQgPT0gImVzY2FsYXRlIjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuZXNjYWxhdGVfcHJpdmlsZWdlcygpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSB7ZGF0YX0iKQogICAgICAgIGVsaWYgY21kID09ICJzaHV0ZG93biI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLnNodXRkb3duX3N5c3RlbSgpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJyZXN0YXJ0IjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wucmVzdGFydF9zeXN0ZW0oKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZCA9PSAibG9nb2ZmIjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wubG9nb2ZmX3VzZXIoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZCA9PSAid2lmaV9wYXNzd29yZHMiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5nZXRfd2lmaV9wYXNzd29yZHMoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJwb3J0X3NjYW4gIik6CiAgICAgICAgICAgIHBhcnRzID0gY21kLnNwbGl0KCIgIikKICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA9PSAzOgogICAgICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wucG9ydF9zY2FuKHBhcnRzWzFdLCBwYXJ0c1syXSkKICAgICAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoInJlY29yZF9taWMgIik6CiAgICAgICAgICAgIHNlY29uZHMgPSBjbWRbMTA6XS5zdHJpcCgpCiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLnJlY29yZF9taWNyb3Bob25lKGludChzZWNvbmRzKSkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgicmVjb3JkX3NjcmVlbiAiKToKICAgICAgICAgICAgc2Vjb25kcyA9IGNtZFsxMzpdLnN0cmlwKCkKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wucmVjb3JkX3NjcmVlbihpbnQoc2Vjb25kcykpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJrZXlsb2dnZXIgc3RhcnQiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5zdGFydF9rZXlsb2dnZXIoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZCA9PSAia2V5bG9nZ2VyIHN0b3AiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5zdG9wX2tleWxvZ2dlcigpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJrZXlsb2dnZXIgZHVtcCI6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCJrZXlsb2cudHh0Iik6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oImtleWxvZy50eHQiLCAiciIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGYucmVhZCgpCiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNvY2suc2VuZChiIk5vIGtleWxvZyBkYXRhIGF2YWlsYWJsZSIpCiAgICAgICAgZWxpZiBjbWQgPT0gImNsaXBib2FyZF9nZXQiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5nZXRfY2xpcGJvYXJkKCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiY2xpcGJvYXJkX3NldCAiKToKICAgICAgICAgICAgdGV4dCA9IGNtZFsxMzpdLnN0cmlwKCkKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuc2V0X2NsaXBib2FyZCh0ZXh0KQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZCA9PSAibWVsdCI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLm1lbHQoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZCA9PSAiaGVscCI6CiAgICAgICAgICAgIGhlbHBfdGV4dCA9ICIiIj09PSBSQVQgVE9PTCAgLSBUaHJlYWRsaW5lZSA9PT0KClvwn5OBXSBGaWxlIFN5c3RlbToKLSBmaWxlX2xpc3QgW3BhdGhdICAgICAgICAtIExpc3QgZGlyZWN0b3J5IGNvbnRlbnRzCi0gZmlsZV9yZWFkIFtwYXRoXSAgICAgICAtIERvd25sb2FkIGEgZmlsZQotIGZpbGVfdXBsb2FkIFtsb2NdIFtyZW1dIC0gVXBsb2FkIGZpbGUgdG8gdmljdGltCi0gZmlsZV9kZWxldGUgW3BhdGhdICAgICAtIERlbGV0ZSBmaWxlL2ZvbGRlcgotIHppcF9mb2xkZXIgW3BhdGhdICAgICAgLSBDb21wcmVzcyBmb2xkZXIKLSBhdXRvZG93bmxvYWQgICAgICAgICAgIC0gR3JhYiBmaWxlcyBmcm9tIERlc2t0b3AvRG9jcy9Eb3dubG9hZHMKClvwn5SSXSBFbmNyeXB0aW9uOgotIGVuY3J5cHQgW2ZpbGVdICAgICAgICAgLSBFbmNyeXB0IGZpbGUgKEFFUy0yNTYpCi0gZGVjcnlwdCBbZmlsZV0gW2tleV0gICAtIERlY3J5cHQgZmlsZQoKW/CflqXvuI9dIFN5c3RlbSBDb250cm9sOgotIHN5c2luZm8gICAgICAgICAgICAgICAgLSBHZXQgZGV0YWlsZWQgc3lzdGVtIGluZm8KLSB0ZXJtaW5hdGUgW3Byb2Nlc3NdICAgIC0gS2lsbCBhIHByb2Nlc3MKLSBlc2NhbGF0ZSAgICAgICAgICAgICAgIC0gQXR0ZW1wdCBhZG1pbiBwcml2aWxlZ2VzCi0gc2h1dGRvd24gICAgICAgICAgICAgICAtIFNodXRkb3duIHN5c3RlbQotIHJlc3RhcnQgICAgICAgICAgICAgICAgLSBSZXN0YXJ0IHN5c3RlbQotIGxvZ29mZiAgICAgICAgICAgICAgICAgLSBMb2dvZmYgY3VycmVudCB1c2VyCgpb8J+TuF0gU3VydmVpbGxhbmNlOgotIHdlYmNhbSAgICAgICAgICAgICAgICAgLSBUYWtlIHdlYmNhbSBwaG90bwotIHNjcmVlbnNob3QgICAgICAgICAgICAgLSBDYXB0dXJlIHNjcmVlbgotIHJlY29yZF9taWMgW3NlY29uZHNdICAgLSBSZWNvcmQgbWljcm9waG9uZQotIHJlY29yZF9zY3JlZW4gW3NlY29uZHNdLSBSZWNvcmQgc2NyZWVuIGFjdGl2aXR5Cgpb4oyo77iPXSBLZXlsb2dnZXI6Ci0ga2V5bG9nZ2VyIHN0YXJ0ICAgICAgICAtIFN0YXJ0IGtleWxvZ2dlcgotIGtleWxvZ2dlciBzdG9wICAgICAgICAgLSBTdG9wIGtleWxvZ2dlcgotIGtleWxvZ2dlciBkdW1wICAgICAgICAgLSBHZXQga2V5bG9nZ2VyIGRhdGEKClvwn4yQXSBOZXR3b3JrOgotIHdpZmlfcGFzc3dvcmRzICAgICAgICAgLSBHZXQgc2F2ZWQgV2lGaSBwYXNzd29yZHMKLSBwb3J0X3NjYW4gW2lwXSBbcmFuZ2VdIC0gU2NhbiBmb3Igb3BlbiBwb3J0cwoKW/Cfk4tdIENsaXBib2FyZDoKLSBjbGlwYm9hcmRfZ2V0ICAgICAgICAgIC0gR2V0IGNsaXBib2FyZCBjb250ZW50cwotIGNsaXBib2FyZF9zZXQgW3RleHRdICAgLSBTZXQgY2xpcGJvYXJkIHRleHQKClvimpnvuI9dIE90aGVyOgotIG1lbHQgICAgICAgICAgICAgICAgICAgLSBTZWxmLWRlc3RydWN0IHBheWxvYWQKLSBoZWxwICAgICAgICAgICAgICAgICAgIC0gU2hvdyB0aGlzIG1lbnUKLSBleGl0ICAgICAgICAgICAgICAgICAgIC0gQ2xvc2UgY29ubmVjdGlvbgoiIiIKICAgICAgICAgICAgc29jay5zZW5kKGhlbHBfdGV4dC5lbmNvZGUoKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBvdXRwdXQgPSBzdWJwcm9jZXNzLmdldG91dHB1dChjbWQpCiAgICAgICAgICAgIHNvY2suc2VuZChvdXRwdXQuZW5jb2RlKCkpCiAgICAgICAgICAgIHNhdmVfbG9nKGYiWytdIENvbW1hbmQ6IHtjbWR9XG57b3V0cHV0fSIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgc29jay5zZW5kKHN0cihlKS5lbmNvZGUoKSkKICAgICAgICBzYXZlX2xvZyhmIlstXSBDb21tYW5kIGZhaWxlZDoge2NtZH1cbkVycm9yOiB7c3RyKGUpfSIpCgpkZWYgY29ubmVjdF90b19jMigpOgogICAgd2hpbGUgVHJ1ZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHMgPSBzb2NrZXQuc29ja2V0KCkKICAgICAgICAgICAgcy5zZXR0aW1lb3V0KDMwKQogICAgICAgICAgICBwcmludChmIlsqXSBUcnlpbmcgdG8gY29ubmVjdCB0byAxMC4yLjAuMjo0NDQ0IikKICAgICAgICAgICAgcy5jb25uZWN0KCgiMTAuMi4wLjIiLCA0NDQ0KSkKICAgICAgICAgICAgcy5zZXR0aW1lb3V0KE5vbmUpCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gQ29ubmVjdGVkIHRvIEMyIHNlcnZlciIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzLnNlbmQoanNvbi5kdW1wcyhWaWN0aW1Db250cm9sLmdldF9mdWxsX2luZm8oKSkuZW5jb2RlKCkpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNtZCA9IHMucmVjdigxMDI0KS5kZWNvZGUoKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNtZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBpZiBjbWQgPT0gImV4aXQiOgogICAgICAgICAgICAgICAgICAgICAgICBWaWN0aW1Db250cm9sLnN0b3Bfa2V5bG9nZ2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgcy5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGhhbmRsZV9jb21tYW5kKHMsIGNtZCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBzb2NrZXQudGltZW91dDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNhdmVfbG9nKGYiWy1dIENvbW1hbmQgZXJyb3I6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2F2ZV9sb2coZiJbLV0gQ29ubmVjdGlvbiBlcnJvcjoge3N0cihlKX0iKQogICAgICAgICAgICB0aW1lLnNsZWVwKDMwKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIGhpZGVfY29uc29sZSgpCiAgICBhZGRfdG9fc3RhcnR1cCgpCiAgICBjb25uZWN0X3RvX2MyKCkK').decode())